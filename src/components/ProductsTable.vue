<script>
import { computed, onMounted, ref } from 'vue';
import { useRouter } from 'vue-router';
import useStore from '@/stores';

export default {
  setup() {
    const { adminStore, adminProductStore } = useStore();
    const { handleSetLogout, handleClearToken } = adminStore;
    const { productList, handleGetProductList, functionSelected, handleSelectFunction } =
      adminProductStore;
    const router = useRouter();
    const tempProduct = ref({
      title: '',
      category: '',
      origin_price: 0,
      price: 0,
      unit: '',
      description: '',
      content: '',
      is_enabled: '',
      imageUrl: '',
      imagesUrl: [],
    });

    function handleIsLogout() {
      handleClearToken();
      handleSetLogout();
      router.push('/');
    }

    onMounted(() => {
      handleGetProductList();
      // handleGetProductAll();
    });
    return {
      productList: computed(() => productList),
      openModal,
      tempProduct,
      handleIsLogout,
      handleGetProductList,
      functionSelected: computed(() => functionSelected),
      handleSelectFunction,
    };
  },
};
</script>
<template>
  <section class="space-y-4 overflow-auto p-2">
    <div class="flex items-center justify-end gap-4 p-6">
      <h2 class="text-4xl font-medium">產品列表</h2>
      <h2 class="ml-auto text-xl">管理者登出</h2>
      <button
        class="rounded bg-danger-500 px-6 py-2 text-white transition duration-300 hover:bg-danger-600 hover:shadow hover:shadow-danger-400"
        @click="handleIsLogout()"
      >
        登出
      </button>
    </div>
    <table class="mb-4 table-auto rounded bg-gray-50">
      <thead class="bg-gray-800">
        <tr class="text-white">
          <td width="200" class="whitespace-nowrap p-4 text-lg">產品名稱</td>
          <td width="250" class="whitespace-nowrap p-4 text-right text-lg">原價</td>
          <td width="250" class="whitespace-nowrap p-4 text-right text-lg">售價</td>
          <td width="250" class="whitespace-nowrap p-4 text-center text-lg">是否啟用</td>
          <td width="200" class="whitespace-nowrap p-4 text-center text-lg">查看細節</td>
          <td colspan="2" width="400" class="whitespace-nowrap p-4 text-center text-lg">功能</td>
        </tr>
      </thead>
      <tbody>
        <tr
          class="border-b border-gray-300 hover:bg-gray-200"
          v-for="item in productList.products"
          :key="item.id"
        >
          <td class="whitespace-nowrap py-2 px-4">{{ item.title }}</td>
          <td class="whitespace-nowrap py-2 px-4 text-right">
            {{ item.origin_price }}
          </td>
          <td class="whitespace-nowrap py-2 px-4 text-right">
            {{ item.price }}
          </td>
          <td
            class="whitespace-nowrap py-2 px-4 text-center text-primary-400"
            v-if="item.is_enabled == 1"
          >
            啟用
          </td>
          <td
            class="whitespace-nowrap py-2 px-4 text-center text-gray-400"
            v-else-if="item.is_enabled == 0"
          >
            未啟用
          </td>
          <td
            class="whitespace-nowrap py-2 px-4 text-center text-warning-600"
            v-else-if="item.is_enabled == 2"
          >
            未上架
          </td>
          <td
            class="whitespace-nowrap py-2 px-4 text-center text-danger-700"
            v-if="item.is_enabled == 3"
          >
            已下架
          </td>

          <td class="whitespace-nowrap py-2 px-4 text-center">
            <button
              type="button"
              class="rounded bg-primary-500 py-2 px-4 text-white transition duration-200 hover:bg-primary-600 hover:shadow hover:shadow-primary-400"
              @click="handleSelectFunction('getDetail', item)"
            >
              查看細節
            </button>
          </td>
          <td class="whitespace-nowrap py-2 px-4 text-center">
            <button
              type="button"
              class="rounded bg-secondary-700 py-2 px-4 text-white transition duration-200 hover:bg-secondary-800 hover:shadow hover:shadow-secondary-400"
              @click="handleSelectFunction('productEdit', item)"
            >
              修改內容
            </button>
          </td>
          <td class="whitespace-nowrap py-2 px-4 text-center">
            <button
              type="button"
              class="rounded bg-danger-500 py-2 px-4 text-white transition duration-200 hover:bg-danger-600 hover:shadow hover:shadow-danger-400"
              @click="handleSelectFunction('productDelete', item)"
            >
              刪除品項
            </button>
          </td>
        </tr>
      </tbody>
    </table>
    <div class="flex items-center justify-between">
      <p>目前有{{ productList.products.length }}項產品</p>
      <button
        type="button"
        class="rounded bg-warning-500 py-2 px-4 text-white transition duration-200 hover:bg-warning-600 hover:shadow hover:shadow-warning-400"
        @click="handleSelectFunction('productCreate', tempProduct)"
      >
        新增品項
      </button>
    </div>
    <!-- 分頁 -->
    <div>
      <ul class="flex items-center justify-center gap-2">
        <li class="">
          <button
            type="button"
            class="rounded border border-primary-500 p-2 text-primary-500 disabled:border-gray-400 disabled:text-gray-500"
            :disabled="!productList.pagination.has_pre"
            @click="handleGetProductList(productList.pagination.current_page - 1)"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              fill="currentColor"
              class=""
              viewBox="0 0 16 16"
            >
              <path
                fill-rule="evenodd"
                d="M12 8a.5.5 0 0 1-.5.5H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5a.5.5 0 0 1 .5.5z"
              />
            </svg>
          </button>
        </li>
        <li v-for="page in productList.pagination.total_pages" :key="page + new Date()">
          <button
            type="button"
            class="rounded border-primary-500 py-[6px] px-3"
            :class="{
              'bg-primary-700 text-white': page === productList.pagination.current_page,
            }"
            @click="handleGetProductList(page)"
          >
            {{ page }}
          </button>
        </li>
        <li class="">
          <button
            type="button"
            class="rounded border border-primary-500 p-2 text-primary-500 disabled:border-gray-400 disabled:text-gray-500"
            :disabled="!productList.pagination.has_next"
            @click="handleGetProductList(productList.pagination.current_page + 1)"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              fill="currentColor"
              class=""
              viewBox="0 0 16 16"
            >
              <path
                fill-rule="evenodd"
                d="M4 8a.5.5 0 0 1 .5-.5h5.793L8.146 5.354a.5.5 0 1 1 .708-.708l3 3a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708-.708L10.293 8.5H4.5A.5.5 0 0 1 4 8z"
              />
            </svg>
          </button>
        </li>
      </ul>
    </div>
  </section>
</template>
